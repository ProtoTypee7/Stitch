@model P2WebMVC.Models.ViewModels.ProductView
@{
    ViewData["Title"] = "Products";
}
<h2 class="text-center my-4">@ViewBag.Category</h2>

@if (!string.IsNullOrEmpty(ViewBag.Message))
{
    <div class="alert alert-info text-center">@ViewBag.Message</div>
}
else
{
    <div class="container">
        <div class="row row-cols-2 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4">
            @foreach (var product in Model.Products)
            {
                <div class="col">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="position-relative">
                            <a asp-controller="Product" asp-action="Details" asp-route-ProductId="@product.ProductId">
                                <img src="@product.ProductImage" class="card-img-top w-100"
                                    style="object-fit: cover; aspect-ratio: 3/4;" alt="@product.ProductName" />
                            </a>
                            <form asp-controller="User" asp-action="AddToWishlist" method="post"
                                class="position-absolute top-0 end-0 m-2">
                                <input type="hidden" name="userId" value="@ViewBag.UserId" />
                                <input type="hidden" name="productId" value="@product.ProductId" />
                                <button type="submit" class="btn text-danger bg-white rounded-circle p-2 border-0">
                                    <i class="bi bi-heart"></i>
                                </button>
                            </form>
                        </div>

                        <div class="card-body px-3 py-2">
                            <p class="fw-semibold small text-uppercase mb-1 text-muted">@product.ProductDescription</p>
                            <h6 class="card-title text-dark mb-1" style="font-size: 1rem;">@product.ProductName</h6>
                            <p class="fw-bold mb-2">Rs.@product.ProductPrice.ToString("N2")</p>

                            @if (!string.IsNullOrEmpty(product.Color))
                            {
                                var colors = product.Color.Split(',', StringSplitOptions.RemoveEmptyEntries);
                                <div class="d-flex gap-1 align-items-center mb-2">
                                    @foreach (var clr in colors.Take(4))
                                    {
                                        <div class="border rounded-circle" title="@clr.Trim()"
                                            style="width: 14px; height: 14px; background-color: @clr.Trim();"></div>
                                    }
                                    @if (colors.Length > 4)
                                    {
                                        <small class="text-muted">+@((colors.Length - 4).ToString())</small>
                                    }
                                </div>
                            }

                           <div class="d-flex flex-column flex-md-row gap-2 mt-2">
    <a asp-controller="Product" asp-action="Details" asp-route-ProductId="@product.ProductId"
       class="btn btn-outline-dark btn-sm w-100 w-md-50">Details</a>
    <form asp-controller="Product" asp-action="AddToCart" method="post" class="w-100 w-md-50">
    <input type="hidden" name="ProductId" value="@product.ProductId" />
    <button type="submit" class="btn btn-dark btn-sm w-100">Add to Cart</button>
</form>

</div>

                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
}
